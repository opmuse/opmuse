{% import "macros/urls.html" as urls %}

{% macro album_header(info, html = true) %}
    {%- if info.artists|length == 1 -%}
        {%- if html -%}
            <a href="{{ urls.artist_url(info.artists[0]) }}">
        {%- endif -%}
            {{ info.artists[0].name|show_ws }}
        {%- if html -%}
            </a>
        {%- endif %} -
    {%- endif %}
    {%- if info.album -%}
        {%- if html -%}
            <a href="{{ urls.album_url(info.album) }}">
        {%- endif %} {{ info.album.name|show_ws }}
        {%- if html -%}
            </a>
        {%- endif -%}
    {%- else -%}
        N/A {% endif -%}
    {%- if info.disc %} - Disc {{ info.disc }}
    {%- endif -%}
{% endmacro %}

<div class="btn-group btn-clear">
    <a
        id="clear-queue"
        class="btn btn-mini btn-danger"
        accesskey="t"
        href="/queue/clear">
        <i class="icon-remove-sign"></i>
        All
    </a>
    <a
        id="clear-played-queue"
        accesskey="r"
        class="btn btn-mini btn-danger"
        href="/queue/clear/played">
        <i class="icon-remove-sign"></i>
        played
    </a>
</div>

<div class="btn-stream">
    <a class="open-stream" target="_blank" href="/play.m3u" accesskey="d">
        <i class="icon-download"></i>
    </a>
    <a class="open-stream open btn btn-mini" target="_blank" href="/play.m3u">
        <i class="icon-download"></i>
        Stream
    </a>
</div>

<div class="clear"></div>

<div class="tracks-wrapper nano">
    <ol class="tracks content">
        {% for info, queue in queues %}
            <li class="album">
                <span class="album-header" title="{{ album_header(info, false)|e }}">
                    <span class="album-header-icon">
                        <i class="icon-sign-blank"></i>
                    </span>
                    {{ album_header(info) }}
                </span>
                <span class="album-info">
                    <span class="album-duration">
                        {{ info.duration|format_seconds }}
                    </span>
                    <a
                        class="remove"
                        href="/queue/remove/
                        {%- for q in queue -%}
                            {{ q.track.id }},
                        {%- endfor -%}
                        ">
                        <span class="icon-remove-sign"></span>
                    </a>
                </span>
            </li>
            {% for q in queue %}
                <li class="track {{ "current active" if q.current }} {{ "played" if q.played }}"
                    data-queue-id="{{ q.id }}">
                    <span class="text">
                        <span class="track-icon">
                            <i class="noplay-icon icon-check-empty"></i>
                            <i class="current-icon icon-play"></i>
                            <i class="played-icon icon-check"></i>
                        </span>
                        <span class="track-number">
                            {% if q.track.number %}
                                {{ q.track.number }}
                            {% endif %}
                        </span>
                        {% if info.artists|length > 1 %}
                            <span class="artist-name" title="{{ q.track.artist.name|show_ws }}">
                                <a href="{{ urls.artist_url(q.track.artist) }}">
                                    {{ q.track.artist.name|show_ws }}
                                </a>
                            </span>
                        {% endif %}
                        <span class="track-name" title="{{ q.track.name|show_ws }}">
                            <a href="/library/track/{{ q.track.slug|urlencode }}">
                                {{ q.track.name|show_ws }}
                            </a>
                        </span>
                    </span>
                    <span class="track-info">
                        <span class="track-duration">
                            {{ q.track.duration|format_seconds }}
                        </span>
                        {% if not q.current %}
                            <a
                                class="remove"
                                href="/queue/remove/{{ q.track.id }}">
                                <span class="icon-remove-sign"></span>
                            </a>
                        {% endif %}
                    </span>
                    <div class="clear"></div>
                </li>
            {% endfor %}
        {% endfor %}
    </ol>
</div>
