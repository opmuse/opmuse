{% macro album_desc(album, href) %}
    {%- if album.artists|length > 1 -%}
        with {% for artist in album.artists -%}
        {%- if not loop.first and not loop.last %}, {% elif loop.last %} and {% endif -%}
            {%- if href -%}
                <a href="/{{ artist.slug|urlencode }}">{{ artist.name|show_ws }}</a>
            {%- else -%}
                {{ artist.name|show_ws }}
            {%- endif -%}
        {%- endfor -%}.
    {%- else -%}
        by {% if href -%}
            <a href="/{{ album.artists[0].slug|urlencode }}">{{ album.artists[0].name|show_ws }}</a>
        {%- else -%}
            {{ album.artists[0].name|show_ws }}
        {%- endif -%}
        .
    {%- endif -%}
{% endmacro %}

{% import "macros/covers.html" as covers %}

<div class="album-container">
    <div class="album {{ 'invalid' if album.invalid else '' }}">
        <div class="album-badges">
            <p class="album-track-count badge badge-inverse">{{ album.tracks|count }} tracks</p>
            <p class="album-track-count badge badge-inverse">{{ album.duration|format_seconds }}</p>
            <p class="album-track-count badge badge-inverse">{{ album.added|pretty_date }}</p>
        </div>
        <div class="album-badges bottom">
            {% if album.low_quality %}
                <p class="album-low-quality badge badge-warning"
                    title="Album has tracks of low quality, consider replacing them.">
                    <i class="icon-thumbs-down"></i>
                </p>
            {% endif %}
            {% if album.invalid %}
            <p class="album-invalid badge badge-important" title="This album containts invalid tracks.">
                <i class="icon-warning-sign"></i>
            </p>
            {% endif %}
            {% if album.is_va %}
                <p class="album-va badge badge-success">VA</p>
            {% endif %}
        </div>
        <a class="queue add add-album btn btn-small btn-inverse"
            href="/queue/add/
                {%- for track in album.tracks -%}
                    {{ track.id }},
                {%- endfor -%}">
            <i class="icon-headphones"></i>
        </a>
        {% if album.is_va %}
            {% set album_url =  "va/" + album.slug|urlencode %}
        {% else %}
            {% set album_url = (album.artists[0].slug|urlencode if not artist else artist.slug|urlencode) +
                                "/" + album.slug|urlencode %}
        {% endif %}
        <a href="/{{ album_url }}">
            {{ covers.album(album) }}
        </a>
        <div class="album-desc">
            <h3 class="album-name" title="{{ album.name }} {% if album.date %}({{ album.date }}){% endif %}">
                <a href="/{{ album_url }}">
                    {{ album.name|show_ws }}
                    {% if album.date %}
                        <small>({{ album.date }})</small>
                    {% endif %}
                </a>
            </h3>
            <p title="{{ album_desc(album, false)|e }}">
                {{ album_desc(album, true) }}
            </p>
        </div>
    </div>
</div>

