{% macro album_desc(album, href, prefix = true) %}
    {% import "macros/urls.html" as urls %}
    {%- if album.artists|length > 1 -%}
        {% if prefix %}
            with
        {% endif %}
        {% for artist in album.artists -%}
            {%- if not loop.first and not loop.last %}, {% elif loop.last %} and {% endif -%}
            {%- if href -%}
                <a href="{{ urls.artist_url(artist) }}">{{ artist.name|show_ws }}</a>
            {%- else -%}
                {{ artist.name|show_ws }}
            {%- endif -%}
        {%- endfor -%}.
    {%- elif album.artists|length == 1 -%}
        {% if prefix %}
            by
        {% endif %}
        {% if href -%}
            <a href="{{ urls.artist_url(album.artists[0]) }}">{{ album.artists[0].name|show_ws }}</a>
        {%- else -%}
            {{ album.artists[0].name|show_ws }}
        {%- endif -%}
        .
    {%- else -%}
        by Unknown Artist.
    {%- endif -%}
{% endmacro %}

{% macro album_queue_btn(album) %}
    <a class="queue add add-album btn btn-small btn-inverse"
        href="/queue/add/
            {%- for track in album.tracks -%}
                {{ track.id }},
            {%- endfor -%}">
        <i class="icon-headphones"></i>
    </a>
{% endmacro %}

{% macro album(artist, album) %}
    {% import "macros/urls.html" as urls %}
    {% import "macros/covers.html" as covers %}

    <div class="album-container">
        <div class="album {{ 'invalid' if album.invalid else '' }}">
            <div class="album-badges">
                <p class="album-track-count badge badge-inverse">{{ album.tracks|count }} tracks</p>
                <p class="album-duration badge badge-inverse">{{ album.duration|format_seconds }}</p>
                <p class="album-added badge badge-inverse">{{ album.added|pretty_date }}</p>
            </div>
            <div class="album-badges bottom">
                {% if album.is_va %}
                    <p class="album-va badge badge-success">VA</p>
                {% endif %}
                {% if album.low_quality %}
                    <p class="album-low-quality badge badge-warning"
                        title="Album has tracks of low quality, consider replacing them.">
                        <i class="icon-thumbs-down"></i>
                    </p>
                {% endif %}
                {% if album.invalid %}
                <p class="album-invalid badge badge-important" title="This album containts invalid tracks.">
                    {% if "dir" in album.invalid %}
                        <i class="icon-folder-open"></i>
                    {% endif %}
                    {% if "incomplete_tags" in album.invalid %}
                        <i class="icon-tag"></i>
                    {% endif %}
                    {% if "broken_tags" in album.invalid %}
                        <i class="icon-tags"></i>
                    {% endif %}
                    {% if "missing_tags" in album.invalid %}
                        <i class="icon-circle-blank"></i>
                    {% endif %}
                </p>
                {% endif %}
            </div>
            {{ album_queue_btn(album) }}
            {% set album_url = urls.album_url(album, artist) %}
            <a href="{{ album_url }}">
                {{ covers.album(album) }}
            </a>
            <div class="album-desc">
                <h3 class="album-name" title="{{ album.name }} {% if album.date %}({{ album.date }}){% endif %}">
                    <a href="{{ album_url }}">
                        <span>
                            {{ album.name|show_ws }}
                        </span>
                        <span class="album-date">
                            {%- if album.date -%}
                                {{ album.date }}
                            {%- else -%}
                                N/A
                            {%- endif -%}
                        </span>
                    </a>
                </h3>
                {% if not artist or album.artists|length > 1 %}
                    <p title="{{ album_desc(album, false)|e }}">
                        {{ album_desc(album, true) }}
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
{% endmacro %}
