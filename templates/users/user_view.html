{% extends "body_twocol.html" %}

{% block title %}
    User - {{ user.login }}
{% endblock %}

{% block right %}
<div class="panel panel-default sidebar-nav">
    {% if remotes_user.lastfm %}
    <div class="panel-heading">
        <h3 class="panel-title">{{ user.login }}</h3>
    </div>
    <ul class="list-group">
        <li class="list-group-item">
            <a href="{{ remotes_user.lastfm.url }}">on Lastfm</a>
        </li>
    </ul>
    {% endif %}
</div>
{% endblock %}

{% set subnav_file_path = "partials/users-nav.html" %}

{% block content %}
<div id="users">
    {% if is_granted('admin') %}
        <a href="/users/user/{{ user.login }}/edit" class="btn btn-default btn-sm">
            <i class="fa fa-pencil"></i>
            Edit User
        </a>
    {% endif %}

    <hr />

    <div class="row">
        <div class="col-xs-11">
            <div class="media">
                <img class="pull-left media-object img-rounded" src="{{ user.gravatar_large }}" alt="{{ user.login }}'s Gravatar" />
                <div class="media-body">
                    <h4 class="media-heading">{{ user.login }}</h4>
                    <dl class="dl-horizontal">
                        <dt>Mail</dt>
                        <dd>{{ user.mail }}</dd>
                        <dt>Roles</dt>
                        <dd>
                            {% for role in user.roles %}
                                {{ role.name }}
                                {% if not loop.last %},{% endif %}
                            {% endfor %}
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    {% if remotes_user %}
        <div class="row">
            <div class="col-xs-5">
                {% if remotes_user.lastfm.top_artists_overall %}
                    <table class="table table-striped table-bordered">
                        <tr>
                            <th colspan="3">Lastfm Top Artists</th>
                        </tr>
                        {% for artist in remotes_user.lastfm.top_artists_overall %}
                        <tr>
                            <td>{{ artist.index }}</td>
                            <td><a href="/search/{{ artist.name }}/artist">{{ artist.name|show_ws }}</a></td>
                            <td>{{ artist.weight|format_number }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                {% endif %}
            </div>
            <div class="col-xs-6">
                {% if remotes_user.lastfm %}
                    <table class="table table-striped table-bordered">
                        <tr>
                            <th colspan="2">Lastfm Recent Tracks</th>
                        </tr>
                        {% for track in remotes_user.lastfm.recent_tracks %}
                        {% if not last_track or last_track.artist != track.artist %}
                        <tr>
                            <th colspan="2"><a href="/search/{{ track.artist }}/artist">{{ track.artist }}</a></th>
                        </tr>
                        {% endif %}
                        <tr>
                            <td>{{ track.timestamp|pretty_date }}</td>
                            <td><a href="/search/{{ track.name }}">{{ track.name|show_ws }}</a></td>
                        </tr>
                        {% set last_track = track %}
                        {% endfor %}
                    </table>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

